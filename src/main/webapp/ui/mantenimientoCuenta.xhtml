*<ui:composition xmlns="http://www.w3.org/1999/xhtml"
                xmlns:ui="http://java.sun.com/jsf/facelets"
                xmlns:h="http://java.sun.com/jsf/html"
                xmlns:f="http://java.sun.com/jsf/core"
                xmlns:p="http://primefaces.org/ui" 
                xmlns:c="http://xmlns.jcp.org/jsp/jstl/core"
                template="../templates/templateWorkspace.xhtml" >

    <ui:define name="head"> 
    </ui:define>

    <ui:define name="cabecera">
        <ui:include src="cabecera.xhtml" />
    </ui:define>

    <ui:define name="content">     
        <p:panel>
            <h:form id="formUsuario">

                <p:card id="cardFormUsuario">

                    <h3>Formulario de usuarios</h3>

                    <p:growl id="growlFormUduario" showDetail="false" life="4000" />

                    <div class="ui-fluid p-formgrid p-grid">

                        <div class="p-field p-col-12 p-md-4">
                            <div class="p-field p-grid">
                                <div class="p-col">
                                    <p:outputLabel for="@next" value="Email" />
                                    <p:inputText id="idMail" type="text" value="#{mantenimientoCuentaView.usuarioForm.usIdMail}" required="true" maxlength="100" disabled="#{mantenimientoCuentaView.isEdit}" >
                                        <f:validator validatorId="validarCorreo" />
                                    </p:inputText>
                                    <p:message for="idMail" display="text" style="width: 100%; margin: 0 0 0 0;" />
                                </div>
                            </div>
                        </div>

                        <div class="p-field p-col-12 p-md-4">
                            <div class="p-field p-grid">
                                <div class="p-col">
                                    <p:outputLabel for="@next" value="Nombre del usuario" />
                                    <p:inputText id="strDescEmpresa" value="#{mantenimientoCuentaView.usuarioForm.usTxDescripcionEmpresa}" required="true" maxlength="100" >
                                        <f:validator validatorId="validaTextoIngresado" />
                                    </p:inputText>
                                    <p:message for="strDescEmpresa" display="text" style="width: 100%; margin: 0 0 0 0;"/>
                                </div>
                            </div>
                        </div>

                        <div class="p-field p-col-12 p-md-4">
                            <div class="p-field p-grid">
                                <div class="p-col">
                                    <p:outputLabel for="@next" value="Razón social" />
                                    <p:inputText id="strRazonSocial" type="text" value="#{mantenimientoCuentaView.usuarioForm.usTxNombreRazonsocial}" required="true" maxlength="100" >
                                        <f:validator validatorId="validaTextoIngresado" />
                                    </p:inputText>
                                    <p:message for="strRazonSocial" display="text" style="width: 100%; margin: 0 0 0 0;" />
                                </div>
                            </div>
                        </div> 

                        <div class="p-field p-col-12 p-md-4">
                            <div class="p-field p-grid">
                                <div class="p-col">
                                    <p:outputLabel for="@next" value="Tipo cuenta" />
                                    <p:selectOneMenu id="idTipoCuenta" value="#{mantenimientoCuentaView.usuarioForm.usIdTipoCuenta}" label="TipoCuenta" required="true" requiredMessage="Debe seleccionar el tipo de cuenta"  >
                                        <f:selectItem itemLabel="Selecciona un tipo de cuenta" itemValue="" />
                                        <f:selectItems value="#{mantenimientoCuentaView.lstTipoCuenta}" var="esta" itemLabel="#{esta.elIdElementoPk}" itemValue="#{esta.elTxDescripcion}" />
                                    </p:selectOneMenu>
                                    <p:message for="idTipoCuenta" display="text" style="width: 100%; margin: 0 0 0 0;" />
                                </div>
                            </div>
                        </div>      


                        <div class="p-field p-col-12 p-md-4">
                            <div class="p-field p-grid">
                                <div class="p-col">
                                    <p:outputLabel for="@next" value="Ubigeo"  />
                                    <p:selectOneMenu id="idPais" value="#{mantenimientoCuentaView.pais}" label="Pais" required="true" requiredMessage="Debe seleccionar el pais de residencia"  >
                                        <f:selectItem itemLabel="Selecciona un pais" itemValue="" />
                                        <f:selectItems value="#{mantenimientoCuentaView.lstPaises}"  var="pais" itemLabel="#{pais.ubTxDescripcion}" itemValue="#{pais.ubIdUbigeoPk}" />
                                        <p:ajax update="idCiudad" listener="#{mantenimientoCuentaView.poblarCiudades()}"/>
                                    </p:selectOneMenu>
                                    <p:message for="idPais" display="text" style="width: 100%; margin: 0 0 0 0;" />
                                </div>
                            </div>
                        </div> 

                        <div class="p-field p-col-12 p-md-4">
                            <div class="p-field p-grid">
                                <div class="p-col">
                                    <p:outputLabel for="@next" value="Ciudad"/>
                                    <p:selectOneMenu id="idCiudad" value="#{mantenimientoCuentaView.ciudad}" label="Ciudad" required="true" disabled="#{mantenimientoCuentaView.pais==null?true:false}" requiredMessage="Debe seleccionar la ciudad de residencia" >
                                        <f:selectItem itemLabel="Selecciona una ciudad" itemValue="" />
                                        <f:selectItems value="#{mantenimientoCuentaView.lstCiudades}"  var="ciudad" itemLabel="#{ciudad.ubTxDescripcion}" itemValue="#{ciudad.ubIdUbigeoPk}" />
                                    </p:selectOneMenu>
                                    <p:message for="idCiudad" display="text" style="width: 100%; margin: 0 0 0 0;" /> 
                                </div>
                            </div>
                        </div> 

                        <div class="p-col-12 p-col-12 p-md-12">
                            <div class="p-field p-formgrid p-grid">
                                <div class="p-field p-col">
                                    <p:commandButton value="Guardar" update="formUsuario,formMntCuenta" process="formUsuario" icon="pi pi-check" actionListener="#{mantenimientoCuentaView.guardarUsuario}" />
                                </div>
                                <div class="p-field p-col">
                                    <p:commandButton value="Limpiar" styleClass="ui-button-secondary" icon="pi pi-times" >
                                        <p:ajax update="formUsuario" resetValues="true" />
                                    </p:commandButton>  
                                </div>
                            </div>
                        </div>

                    </div>

                </p:card>

            </h:form>

            <p:spacer/>


            <h:form id="formMntCuenta">

                <p:card id="panel">

                    <h3>Mantenimiento de usuarios</h3>


                    <p:growl id="growlMntCuenta" showDetail="false" life="4000" />

                    <div class="ui-fluid p-formgrid p-grid">

                        <!--
                        
                                                    <p:commandButton value="Crear usuario nuevo" actionListener="#{mantenimientoCuentaView.abrirPanel}" > 
                                                        <p:ajax event="dialogReturn" listener="#{mantenimientoCuentaView.usuarioCreado}" update=":formMntCuenta" />
                                                    </p:commandButton>
                        -->
                    </div>
                    <div class="p-field p-col-12 p-md-12">
                        <p:dataTable 
                            id="idUsuarios"
                            var="usu"
                            value="#{mantenimientoCuentaView.lstUsuario}" 
                            rows="5"
                            size="small"
                            paginator="true" 
                            paginatorPosition="bottom"
                            paginatorTemplate="{FirstPageLink} {PreviousPageLink} {PageLinks} {NextPageLink} {LastPageLink} {RowsPerPageDropdown}"
                            rowsPerPageTemplate="5,10,15"                                 
                            widgetVar="usu"
                            emptyMessage="No se encontró ningun elemento"
                            filteredValue="#{mantenimientoCuentaView.filteredUsuarios}"
                            globalFilterFunction="#{mantenimientoCuentaView.globalFilterFunction}"
                            rowKey="#{usu.intUsuarioPk}"
                            rowIndexVar="index"
                            >    

                            <!--<p:ajax event="rowSelect" listener="#{mantenimientoCuentaView.cargarContrato}" update=":formContratos:"/>-->

                            <f:facet name="header">
                                <div class="p-d-flex p-ai-center p-jc-between">
                                    <div>
                                        <p:inputText id="globalFilter" onkeyup="PF('usu').filter();" style="width:300px" placeholder="Buscar usuario"/>
                                    </div>
                                </div>
                            </f:facet>

                            <p:column style="width: 40px;">
                                <f:facet name="header">
                                    <h:outputText value="#" />
                                </f:facet>
                                <h:outputText 
                                    value="#{index + 1}" />
                            </p:column> 

                            <p:column headerText="Usuario" >
                                <h:outputText value="#{usu.strEmail}" />
                            </p:column>

                            <p:column headerText="Descripción">
                                <h:outputText value="#{usu.strDescripcion}" />
                            </p:column>
                            <p:column  headerText="Empresa">
                                <h:outputText value="#{usu.strEmpresaDesc}" />
                            </p:column>
                            <p:column headerText="Fecha de creación" style="text-align: center;">                                   
                                <h:outputText value="#{usu.strFechaRegistro}" />
                            </p:column>

                            <p:column headerText="Tipo de usuario" style="text-align: center;">
                                <!--
                                                                <f:facet name="filter">
                                                                    <p:selectOneMenu onchange="PF('usu').filter()" >
                                                                        <f:selectItem itemLabel="Selecciona" itemValue="#{null}" noSelectionOption="true" />
                                                                        <f:selectItems value="#{mantenimientoCuentaView.tipoUsuario}" />
                                                                    </p:selectOneMenu>
                                                                </f:facet>                             
                                -->
                                <h:outputText value="#{usu.strTipoUsuario}" />
                            </p:column>



                            <p:column style="width:50px;text-align: center;">
                                <p:commandButton icon="pi pi-pencil" update="formUsuario" immediate="true" actionListener="#{mantenimientoCuentaView.editarUsuario(usu)}" >
                                </p:commandButton>
                            </p:column>
                            <p:column style="width:50px;text-align: center;">
                                <p:commandButton icon="pi pi-lock" update="formUsuario" immediate="true" onclick="PF('dlgLicencias').hide()"  >
                                </p:commandButton>
                            </p:column>
                        </p:dataTable>
                    </div>


                </p:card>

            </h:form>
            <!--
                        <h:form id="formContratos">
            
                            <h1>Contratos</h1>
                            <p:separator/>
                            <h:panelGrid border="0" columns="1" >  
            
                                <p:growl id="msg" showDetail="true" life="4000" />
            
                                <p:panel id="panelContrato" widgetVar="panelContrato" >
            
                                    <h:panelGrid  id="pnlContrato" columns="3" cellpadding="5" style="margin-left: 20px">                     
            
            
                                        <h:outputLabel for="strUsuario" value="Usuario : " />
                                        <p:inputText id="strUsuario" value="#{mantenimientoCuentaView.contratoFormulario.usuario.usIdMail}" required="false" size="60" maxlength="100" disabled="true"/>
                                        <p:message for="strUsuario" display="icon" /> 
            
                                        <h:outputLabel for="strTarifa" value="Tarifa : " />
                                        <p:selectOneMenu id="strTarifa" value="#{mantenimientoCuentaView.contratoFormulario.tarifa.taIdTarifaPk}"  required="false" maxlength="100" >
                                            <f:selectItem itemLabel="Selecciona un tipo de documento" itemValue="" />
                                            <f:selectItems value="#{mantenimientoCuentaView.lstTarifa}" var="tari" itemLabel="#{tari.taTxDescripcion}" itemValue="#{tari.taIdTarifaPk}" />
                                        </p:selectOneMenu>
                                        <p:message for="strTarifa" display="icon" /> 
            
                                        <h:outputLabel for="strTipoContrato" value="Tipo de Contrato : " />
                                        <p:selectOneMenu id="strTipoContrato" value="#{mantenimientoCuentaView.contratoFormulario.coIdTipoContrato}"  required="false" maxlength="100" >
                                            <f:selectItem itemLabel="Selecciona un tipo de documento" itemValue="" />
                                            <f:selectItems value="#{mantenimientoCuentaView.lstTipoContrato}" var="tipo" itemLabel="#{tipo.taTxDescripcion}" itemValue="#{tipo.taIdTarifaPk}" />
                                            <p:ajax update="strNLiTotal,strNLiDisponible" />
                                        </p:selectOneMenu>
                                        <p:message for="strTipoContrato" display="icon" /> 
            
                                        <h:outputLabel for="strFecCreacion" value="Fecha Creación : " /> 
                                        <p:calendar id="strFecCreacion" value="#{mantenimientoCuentaView.contratoFormulario.coFeCreacion}" pattern="MM/dd/yyyy" effect="fold" required="false" />
                                        <p:message for="strFecCreacion" display="icon" /> 
            
                                        <h:outputLabel for="strNLiTotal" value="N. Lincencia Total : " />
                                        <p:inputText id="strNLiTotal" value="#{mantenimientoCuentaView.contratoFormulario.coNuLicenciaTotal}" required="false" size="60" maxlength="100" disabled="#{mantenimientoCuentaView.contratoFormulario.coIdTipoContrato==23?false:true}" />
                                        <p:message for="strNLiTotal" display="icon" /> 
            
                                        <h:outputLabel for="strNLiDisponible" value="N. Lincencia Disponible: " />
                                        <p:inputText id="strNLiDisponible" value="#{mantenimientoCuentaView.contratoFormulario.coNuLicenciaDisponible}" required="false" size="60" maxlength="100" disabled="#{mantenimientoCuentaView.contratoFormulario.coIdTipoContrato==23?false:true}" />
                                        <p:message for="strNLiDisponible" display="icon" /> 
            
                                        <h:outputLabel for="strFecCulminacion" value="Fecha Culminación : " /> 
                                        <p:calendar id="strFecCulminacion" value="#{mantenimientoCuentaView.contratoFormulario.coFeCulminacion}" pattern="MM/dd/yyyy" effect="fold" required="false" />
                                        <p:message for="strFecCulminacion" display="icon" /> 
            
                                        <h:outputLabel for="strEstado" value="Estado : " />
                                        <p:selectOneMenu id="strEstado" value="#{mantenimientoCuentaView.contratoFormulario.coIdEstado}"  required="false" maxlength="100" >
                                            <f:selectItem itemLabel="Selecciona un tipo de documento" itemValue="" />
                                            <f:selectItems value="#{mantenimientoCuentaView.lstEstadoContrato}" var="esta" itemLabel="#{esta.taTxDescripcion}" itemValue="#{esta.taIdTarifaPk}" />
                                        </p:selectOneMenu>
                                        <p:message for="strEstado" display="icon" /> 
            
                                    </h:panelGrid>
                                    <f:facet name="footer">
                                        <p:commandButton value="Grabar" update=":formContratos:idContratos,:formContratos:msg" actionListener="#{mantenimientoCuentaView.grabarContrato}"/>                        
                                        <p:commandButton value="Limpiar" update=":formContratos" actionListener="#{mantenimientoCuentaView.resetFail}" style="margin-right:20px;" /> 
                                    </f:facet>
                                </p:panel>  
            
                                <p:dataTable 
                                    id="idContratos"
                                    var="cont"
                                    value="#{mantenimientoCuentaView.lstContrato}" 
                                    rows="20"
                                    paginator="true" 
                                    paginatorPosition="bottom"
                                    paginatorTemplate="{CurrentPageReport} {FirstPageLink} {PreviousPageLink} {PageLinks} {NextPageLink} {LastPageLink} {RowsPerPageDropdown}"
                                    rowsPerPageTemplate="5,10,15"                                 
                                    selectionMode="single"
                                    selection="#{mantenimientoCuentaView.contratoSeleccionado}"
                                    widgetVar="idContratos"
                                    emptyMessage="No contratos tarifas registrados" 
                                    rowKey="#{cont.coIdContratoPk}"
                                    style="height: 100%;">    
            
                                    <p:ajax event="rowSelect" listener="#{mantenimientoCuentaView.editContrato}" update=":formContratos:pnlContrato,:formContratos:msg"/>
            
                                    <p:column filterBy="#{cont.tarifa.taIdTarifaPk}" filterMatchMode="contains" headerText="Tarifas" >
                                        <f:facet name="filter">
                                            <h:outputText value="#{cont.tarifa.taIdTarifaPk}" />
                                        </f:facet>
                                        <p:selectOneMenu value="#{cont.tarifa.taIdTarifaPk}"  disabled="true" >
                                            <f:selectItems value="#{mantenimientoCuentaView.lstTarifa}" var="tari" itemLabel="#{tari.taTxDescripcion}" itemValue="#{tari.taIdTarifaPk}" />                                
                                        </p:selectOneMenu>
                                    </p:column>
            
                                    <p:column filterBy="#{cont.coIdTipoContrato}" filterMatchMode="contains" headerText="Contrato" >
                                        <f:facet name="filter">
                                            <h:outputText value="#{cont.coIdTipoContrato}" />
                                        </f:facet>
                                        <p:selectOneMenu value="#{cont.coIdTipoContrato}"  disabled="true" >
                                            <f:selectItems value="#{mantenimientoCuentaView.lstTipoContrato}" var="tipo" itemLabel="#{tipo.taTxDescripcion}" itemValue="#{tipo.taIdTarifaPk}" />
            
                                        </p:selectOneMenu>
                                    </p:column>
            
                                    <p:column filterBy="#{cont.coFeCreacion}" filterMatchMode="contains" headerText="Fecha Creación" >
                                        <f:facet name="filter">
                                            <h:outputText value="#{cont.coFeCreacion}" />
                                        </f:facet>
                                        <h:outputText value="#{cont.coFeCreacion}" />
                                    </p:column> 
            
                                    <p:column filterBy="#{cont.coNuLicenciaTotal}" filterMatchMode="contains" headerText="Licencias Total" >
                                        <f:facet name="filter">
                                            <h:outputText value="#{cont.coNuLicenciaTotal}" />
                                        </f:facet>
                                        <h:outputText value="#{cont.coNuLicenciaTotal}" />
                                    </p:column>
            
                                    <p:column filterBy="#{cont.coNuLicenciaDisponible}" filterMatchMode="contains" headerText="Licencias Disponibles">
                                        <f:facet name="filter">
                                            <h:outputText value="#{cont.coNuLicenciaDisponible}" />
                                        </f:facet>
                                        <h:outputText value="#{cont.coNuLicenciaDisponible}" />
                                    </p:column>
            
                                    <p:column filterBy="#{cont.coFeCulminacion}" filterMatchMode="contains" headerText="Fecha Creación" >
                                        <f:facet name="filter">
                                            <h:outputText value="#{cont.coFeCulminacion}" />
                                        </f:facet>
                                        <h:outputText value="#{cont.coFeCulminacion}" />
                                    </p:column>
            
                                    <p:column filterBy="#{cont.coIdEstado}" filterMatchMode="contains" headerText="Estado" >
                                        <f:facet name="filter">
                                            <h:outputText value="#{cont.coIdEstado}" />
                                        </f:facet>
                                        <p:selectOneMenu value="#{cont.coIdEstado}"  disabled="true" >
                                            <f:selectItems value="#{mantenimientoCuentaView.lstEstadoContrato}" var="est" itemLabel="#{est.taTxDescripcion}" itemValue="#{est.taIdTarifaPk}" />                                
                                        </p:selectOneMenu>
                                    </p:column>
            
                                    <p:column headerText="Eliminar" style="width:50px;text-align: center;">
                                        <p:commandButton icon="ui-icon-trash" update=":formContratos:idContratos,:formContratos:msg" actionListener="#{mantenimientoCuentaView.borrarContrato(cont)}" >
                                            <p:confirm header="Confirmacion" message="Esta seguro que quiere borrar este contrato? Recuerda el contenido no podrá recuperarse" icon="ui-icon-alert" />
                                        </p:commandButton>
                                    </p:column>
            
                                </p:dataTable>
            
                            </h:panelGrid>
                        </h:form>
                        <h:form prependId="false">
                            <p:idleMonitor timeout="3600000" >
                                <p:ajax event="idle" listener="#{usuarioSesion.timeout()}" oncomplete="PF('timeoutDlg').show();"/>
                            </p:idleMonitor>
                            <p:dialog header="Aviso de cierre de sesión" widgetVar="timeoutDlg" width="300" closable="false" maximizable="false" resizable="false" draggable="false" closeOnEscape="false" modal="true" >
                                <h:panelGrid border="0" columns="1" >
                                    <h:outputText value="Por seguridad su sesión fue cerrada tras 60 minutos de inactividad." />
                                    <p:button outcome="iniciar" value="Ok" /> 
                                </h:panelGrid>
                            </p:dialog> 
                        </h:form>
                        
            -->
        </p:panel>
        <p:dialog widgetVar="dlgLicencias" header="Reserva de licencias" width="500"
                  draggable="false" closable="true" hideEffect="drop" closeOnEscape="true" showEffect="drop" 
                  modal="true"
                  resizable="false" >
            <h:form>
                <p:panel>

                    <p:growl id="growlFormUduario" showDetail="false" life="4000" />

                    <div class="ui-fluid p-formgrid p-grid">

                        <div class="p-field p-col-12 p-md-12">
                            <div class="p-field">
                                <p:outputLabel value="Usted requiere el siguiente número de licencias para ejecutar este proceso:"></p:outputLabel>
                            </div>
                            <div class="p-field">
                                <p:card>
                                    <div class="p-field p-formgrid p-grid">
                                        <div class="p-col" style="text-align: center;" >
                                            <p:outputLabel value="#{seguimientoProyectoView.intLicenciasIndividualesRequerido}" />
                                        </div>
                                        <div style="text-align: center" >
                                            <p:divider layout="vertical" />
                                        </div>
                                        <div class="p-col" style="text-align: center;">
                                            <p:outputLabel value="#{seguimientoProyectoView.intLicenciasMasivasRequerido}" />
                                        </div>
                                    </div>
                                    <div class="p-field p-formgrid p-grid">
                                        <div class="p-col" style="text-align: center;">
                                            <p:outputLabel value="Individuales" />
                                        </div>
                                        <div>

                                        </div>
                                        <div class="p-col" style="text-align: center;">
                                            <p:outputLabel value="Masivas" />
                                        </div>
                                    </div>
                                </p:card>
                            </div>
                            <div class="p-field">
                                <p:outputLabel value="¿Desea realizar la reservar para ejecutar este proyecto?" ></p:outputLabel>
                            </div>
                        </div>      
                    </div>
                    <div class="p-col-12 p-col-12 p-md-12">
                        <div class="p-field p-formgrid p-grid">
                            <div class="p-field p-col">
                                <p:commandButton value="Aceptar" style="width: 100%;"  icon="pi pi-lock" update="form"
                                                 actionListener="#{seguimientoProyectoView.reservarLicencias}" oncomplete="PF('dlgLicencias').hide()" />
                            </div>
                            <div class="p-field p-col">
                                <p:commandButton value="Declinar" styleClass="ui-button-danger" 
                                                 style="width: 100%;"
                                                 icon="pi pi-times"  onclick="PF('dlgLicencias').hide()" />
                            </div>
                        </div>
                    </div>

                    <br/>
                    <center>
                        <p:graphicImage value="../images/logoJaio360.jpg" width="130" height="50" />
                    </center>
                </p:panel>
            </h:form>
        </p:dialog>      
    </ui:define>

</ui:composition>